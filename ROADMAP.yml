phases:
  - id: 0
    title: "Phase 0: The IR Kernel (Execution Core)"
    description: "Foundational layer for structured knowledge."
    phase_gate: "A node cannot be deleted if it is a PIN or has active dependents."
    hitos:
      - id: "0.1"
        title: "IR Schema Definition"
        description: "Schema definition for WorkGraph IR (Nodes/Edges/Metadata)."
        status: "done"
        gate: "Zod schema for all node types defined and validated."
        tasks: 
          - "Define PREFLIGHT_TEMPLATE.md (Process)"
          - "Define WorkNodeSchema V2 (Claims, Evidence, Decisions)"
          - "Define NodeMetadataSchema V2 (Confidence, Pin, Validated)"
          - "Define WorkEdgeSchema (Edges)"
        evidence_nodes: 
          - "PLAN-HITO-0.1.md"
          - "src/canon/schema/ir.ts"
          - "tests/schema.test.ts"

      - id: "0.2"
        title: "Versioning Engine"
        description: "Hash-based delta tracking (git-like for the graph)."
        status: "done"
        gate: "Hash-based delta verification operational."
        tasks:
          - "Implement computeNodeHash (kernel)"
          - "Implement verifyIntegrity (kernel)"
          - "Implement createVersion (kernel)"
          - "Implement previous_version_hash chaining"
        evidence_nodes: 
          - "PLAN-HITO-0.2.md"
          - "src/kernel/versioning.ts"
          - "tests/versioning.test.ts"

      - id: "0.3"
        title: "PIN Enforcement"
        description: "PIN/Invariant enforcement logic in the DB layer (Kernel for now)."
        status: "done"
        gate: "Kernel guards preventing contradiction of PIN nodes."
        tasks:
          - "Implement canModifyNode (Guard)"
          - "Implement canDeleteNode (Guard/Dependency Check)"
          - "Implement canAddRelation (Contradiction Prevention)"
          - "Implement checkNodeStaleness (Expiration Logic)"
          - "Implement KernelLogger (Observability)"
        evidence_nodes: 
          - "PLAN-HITO-0.3.md"
          - "src/kernel/guards.ts"
          - "tests/guards.test.ts"
          - "documentacion/HITO_PHASE_2_ENHANCEMENTS.md"

  - id: 1
    title: "Phase 1: RLM Compiler v1 (Deliverable Engine)"
    description: "The primary execution engine for generating deliverables."
    phase_gate: "Deliverables must include an Assertion Map to be marked as 'Done'."
    hitos:
      - id: "1.1"
        title: "Compiler Pipeline (Dry Run)"
        description: "Scaffolding of the RLM compiler (Planner -> Retriever -> Assembler) with deterministic stubs."
        status: "done"
        gate: "Dry run of the pipeline (Input -> Artifact) passes."
        tasks:
          - "Implement Planner (Stub)"
          - "Implement Retriever (Stub)"
          - "Implement Assembler (Stub)"
          - "Implement Pipeline Orchestrator"
        evidence_nodes: 
          - "PLAN-HITO-1.1.md"
          - "src/compiler/index.ts"
          - "tests/compiler.test.ts"

      - id: "1.2"
        title: "Manifest Templates"
        description: "Typed templates for Artifact generation (Code, Docs, Plans)."
        status: "done"
        gate: "Assembler uses typed templates instead of raw strings."
        tasks:
          - "Implement Template Interface"
          - "Implement CodeManifest"
          - "Implement DocManifest"
          - "Implement PlanManifest"
          - "Refactor Assembler to use Templates"
        evidence_nodes: 
          - "PLAN-HITO-1.2.md"
          - "src/compiler/templates/"
          - "tests/templates.test.ts"

      - id: "1.3"
        title: "Proof-Carrying Deliverables"
        description: "Receipts generation for proof of work."
        status: "done"
        gate: "Metadata receipts attached to all outputs."
        tasks:
          - "Define ReceiptSchema & AssertionMapSchema"
          - "Extract Primitives (Schema Refactor)"
          - "Extend ArtifactNode with Receipt"
          - "Update Assembler to attach Receipts"
        evidence_nodes: 
          - "PLAN-HITO-1.3.md"
          - "src/canon/schema/receipt.ts"
          - "src/canon/schema/primitives.ts"
          - "tests/receipts.test.ts"

      - id: "1.4"
        title: "The Verifier Logic"
        description: "Deterministic verification of artifacts (Structure, Integrity, Thresholds)."
        status: "done"
        gate: "The pipeline returns an Artifact containing a VerificationReport."
        tasks:
          - "Define VerificationReportSchema"
          - "Implement src/compiler/verifier.ts"
          - "Implement Filter logic"
          - "Integrate Verifier into Pipeline"
        evidence_nodes: 
          - "PLAN-HITO-1.4.md"
          - "src/compiler/verifier.ts"
          - "tests/verifier.test.ts"


  - id: 2
    title: "Phase 2: Capture & Interface (The Wedge)"
    description: "Expanding the surface area for knowledge entry and interaction."
    phase_gate: "Captures must pass Zod validation before entering the WorkGraph."
    hitos:
      - id: "2.0"
        title: "WorkGraph UI Scaffold"
        description: "Next.js 15 + React Flow + TipTap setup."
        status: "done"
        gate: "UI compiles and renders Graph + Editor."
        tasks: 
          - "Initialize Next.js 15"
          - "Install React Flow & TipTap"
          - "Setup Tailwind & App Router"
        evidence_nodes: 
          - "PLAN-HITO-2.0.md"
          - "src/app/page.tsx"
          - "src/components/graph/WorkGraphCanvas.tsx"

      - id: "2.1"
        title: "The Wiring (Type Integration)"
        description: "Strict typing for the Frontend Store using IR Schemas."
        status: "done"
        gate: "Zero 'any' in useGraphStore.ts and validated sync with IR schema."
        tasks:
          - "Import WorkNode/WorkEdge into Store"
          - "Define AppNode/AppEdge interfaces"
          - "Implement Backend/Flow Adapters"
          - "Connect NodeEditor to Store"
        evidence_nodes:
          - "src/store/useGraphStore.ts"
          - "src/lib/adapters.ts"
          - "src/components/graph/GraphCanvas.tsx"
          - "src/components/editor/NodeEditor.tsx"
          - "documentacion/HITO_2.1_SUMMARY.md"

      - id: "2.2"
        title: "The Deep Editor"
        description: "Bidirectional synchronization, debouncing, and automated traceability."
        status: "done"
        gate: "Real-time sync with debounce and metadata.updated_at tracking."
        tasks:
          - "Implement debounce in NodeEditor"
          - "Auto-update updated_at metadata"
          - "Add node type badge to editor header"
        evidence_nodes:
          - "PLAN-HITO-2.2.md"
          - "src/components/editor/NodeEditor.tsx"
          - "documentacion/HITO_2.2_SUMMARY.md"

      - id: "2.3"
        title: "The Graph Topology"
        description: "Interactivity for growing the graph (Creation, Connection, Mutation)."
        status: "done"
        gate: "Nodes can be created, linked, and mutated while maintaining IR integrity."
        tasks:
          - "Implement addNode action with versioning"
          - "Implement onConnect edge creation logic"
          - "Implement mutateNodeType action with re-hashing"
          - "Add Floating Creation UI"
          - "Implement Double-Click to create (Polish)"
        evidence_nodes:
          - "src/store/useGraphStore.ts"
          - "src/components/graph/GraphCanvas.tsx"
          - "src/components/editor/NodeEditor.tsx"
          - "documentacion/HITO_2.3_SUMMARY.md"

      - id: "2.4"
        title: "The Browser & Discovery"
        description: "Sidebar navigation and real-time search for large graphs."
        status: "done"
        gate: "Sidebar renders node list with functional text search/filter."
        tasks:
          - "Implement Sidebar component"
          - "Integrate real-time search filter"
          - "Sync Sidebar selection with Graph and Editor"
        evidence_nodes:
          - "src/components/layout/Sidebar.tsx"
          - "src/components/layout/NodeListItem.tsx"
          - "src/store/useGraphStore.ts"
          - "documentacion/HITO_2.4_SUMMARY.md"

      - id: "2.5"
        title: "The Persistence Layer (Supabase)"
        description: "Moving from RAM to SQL with bidirectional sync."
        status: "done"
        gate: "Graph survives page refresh via Supabase SQL persistence."
        tasks:
          - "Setup Supabase SQL Schema (init.sql)"
          - "Implement syncService (src/lib/sync.ts)"
          - "Integrate persistence into useGraphStore"
        evidence_nodes:
          - "supabase/migrations/init.sql"
          - "src/lib/sync.ts"
          - "src/store/useGraphStore.ts"
          - "documentacion/HITO_2.5_SUMMARY.md"

      - id: "2.6"
        title: "Chrome MV3 Extension"
        description: "Explicit selection capture for the web."
        status: "done"
        gate: "MV3 extension communicating with Supabase."
        tasks: 
          - "Initialize extension scaffold (Vite + TS)"
          - "Implement Background Worker (Sync logic)"
          - "Implement Context Menu Capture"
          - "Implement Context extraction (Content Script)"
          - "Implement Rich Metadata enrichment (accessed_at, source_title)"
          - "Implement Inbox triage UX in Web App"
          - "Implement Zero-Touch Config (.env injection)"
        evidence_nodes: 
          - "extension/src/background/index.ts"
          - "extension/src/content/index.ts"
          - "src/components/editor/NodeEditor.tsx"
          - "src/canon/schema/ir.ts"
          - "documentacion/HITO_2.6_SUMMARY.md"

      - id: "2.7"
        title: "The Omni-Ingestor"
        description: "Universal Smart & Lossless Ingestion (PDF, Word, Excel, Code) with Semantic Chunking and Instant Vectorization."
        status: "done"
        gate: "Lossless binary storage + Recursive Chunking + pgvector Indexing operational."
        tasks:
          - "Setup Supabase Storage (Bucket: artifacts) with RLS"
          - "Implement Two-Phase Ingest (Upload & Digest)"
          - "Implement SHA-256 Deduplication & Gzip Compression"
          - "Implement Recursive Semantic Chunking"
          - "Implement Instant Vectorization (pgvector)"
          - "Implement SourceNodeView & Fragment Navigation"
        evidence_nodes:
          - "src/lib/ingest/index.ts"
          - "src/lib/ingest/chunking.ts"
          - "src/lib/ingest/vectorizer.ts"
          - "src/components/editor/SourceNodeView.tsx"
          - "documentacion/HITO_2.7_SUMMARY.md"

      - id: "2.8"
        title: "The Window Manager (UX Futurista)"
        description: "Minority Report-style floating windows with glassmorphism for multitasking over the graph."
        status: "done"
        gate: "FloatingPanel component functional and integrated."
        tasks:
          - "Implement FloatingPanel.tsx"
          - "Integrate Window Manager in useGraphStore"
          - "Mount Floating Window in page.tsx"
        evidence_nodes:
          - "src/components/ui/FloatingPanel.tsx"
          - "documentacion/DESIGN_SYSTEM_2.0.md"

      - id: "2.9"
        title: "BYOK Secrets Management"
        description: "Vault integration for user keys."
        status: "done"
        gate: "Encryption at rest for all third-party keys."
        tasks:
          - "Implement KeyVault (AES-GCM Web Crypto)"
          - "Implement Secure Storage Logic (LocalStorage)"
          - "Implement RateLimiter infrastructure"
        evidence_nodes:
          - "src/lib/security/vault.ts"
          - "src/kernel/security/rate-limiter.ts"
          - "documentacion/HITO_PHASE_2_ENHANCEMENTS.md"

  - id: 3
    title: "Phase 3: Scaling & Verification (Operational Excellence)"
    description: "Hardening the system for high-volume data."
    phase_gate: "RLM Compiler identifies contradictions with the Canon automatically."
    hitos:
      - id: "3.1"
        title: "Hierarchical Digests"
        description: "Branch/Project summarization logic."
        status: "done"
        gate: "Automatic summary generation for nested nodes."
        tasks: 
          - "Implement Digest Schema (digests table)"
          - "Implement Digest Engine (Raw-on-Demand retrieval)"
          - "Implement Context Selector (RAW vs DIGEST)"
        evidence_nodes: 
          - "src/kernel/digest_engine.ts"
          - "src/canon/migrations/001_gate7_schema.sql"
          - "documentacion/HITO_3.1_HIERARCHICAL_DIGESTS.md"

      - id: "3.2"
        title: "Staleness Detection"
        description: "Evidence expiration and invalidation warnings."
        status: "done"
        gate: "Evidence age tracking active."
        tasks: 
          - "Implement is_stale flag in table"
          - "Implement markStale logic in Kernel"
          - "Implement Observability Tracing"
        evidence_nodes: 
          - "src/kernel/digest_engine.ts"
          - "src/kernel/observability.ts"
          - "documentacion/HITO_3.2_STALENESS_DETECTION.md"

      - id: "3.3"
        title: "Dynamic Pricing Oracle"
        description: "Real-time pricing for LLM calls via OpenRouter API."
        status: "done"
        gate: "measureCost updates dynamically based on market rates."
        tasks:
          - "Implement PriceRegistry (Singleton)"
          - "Integrate OpenRouter models API"
          - "Implement 24h caching and fallback safety"
        evidence_nodes:
          - "src/kernel/observability.ts"
          - "documentacion/HITO_3.3_DYNAMIC_PRICING.md"

      - id: "3.4"
        title: "Link-OS (Extension V3)"
        description: "Side Panel and Offscreen Parser architecture for deep link analysis."
        status: "done"
        gate: "Extension can parse links into Side Panel and insert into Chat."
        tasks:
          - "Implement Offscreen Document (Readability.js)"
          - "Implement Side Panel UI (React)"
          - "Implement Selection Capture (Wedge)"
          - "Implement Source Metadata extraction (URL, Title, Timestamp)"
          - "Implement Content Script ðŸ§  Trigger"
          - "Implement Insert-to-Chat automation"
        evidence_nodes:
          - "extension/src/background/index.ts"
          - "extension/src/sidepanel/SidePanelViewer.tsx"
          - "documentacion/HITO_3.4_LINK_OS_EXTENSION.md"
          - "documentacion/HITO_PHASE_2_ENHANCEMENTS.md"

      - id: "3.5"
        title: "Identity & Security (Gate 8)"
        description: "Supabase Auth and RLS enforcement for multi-tenant graph nodes."
        status: "done"
        gate: "Secure access to private projects via JWT/RLS."
        tasks: 
          - "Setup Supabase Auth (Sign-in/Sign-up)"
          - "Implement project_id column and RLS policies"
          - "Implement user_id ownership tracking"
        evidence_nodes: 
          - "supabase/migrations/gate8_auth_rls.sql"
          - "documentacion/HITO_3.5_GATE8_IDENTITY.md"

      - id: "3.6"
        title: "Collaborative Governance (Gate 9)"
        description: "AI-Mediated Consensus and Change Request workflows."
        status: "done"
        gate: "Change requests can be visualized with Visual Diff and approved."
        tasks:
          - "Implement project_members and change_requests tables"
          - "Implement RLM Mediator for consensus"
          - "Build Visual Diff Engine (UI)"
          - "Add Native View Transitions API support"
        evidence_nodes:
          - "supabase/migrations/gate9_collaboration.sql"
          - "src/components/collaboration/VisualDiffView.tsx"
          - "documentacion/HITO_3.6_GATE9_COLLABORATION.md"

      - id: "3.7"
        title: "The Brain Transplant (RLM Extension)"
        description: "Real LLM connection, Smart Routing, and Recursive Context Optimization."
        status: "done"
        gate: "System generates infinite-length documents with enforced observability."
        tasks:
          - "Implement Dual-Engine Settings (Reasoning/Efficiency)"
          - "Implement Smart Routing Gateway (traceSpan + measureCost)"
          - "Implement Recursive Language Modeling (RLM Loop)"
          - "Implement Recursive Planner Subdivision"
          - "Implement Selective Retriever (Digests vs Raw)"
          - "Implement TOON Topology-based context filtering"
          - "Add Quality/Fidelity Mode toggle (preventing drift)"
        evidence_nodes:
          - "src/kernel/llm/gateway.ts"
          - "src/compiler/planner.ts"
          - "src/compiler/retriever.ts"
          - "src/compiler/assembler.ts"
          - "documentacion/HITO_3.7_GATE9_EXTENSION_BRAIN.md"
          - "documentacion/HITO_PHASE_2_ENHANCEMENTS.md"

  - id: 4
    title: "Phase 4: Enterprise Hardening"
    description: "Readying the platform for professional organizations."
    phase_gate: "SOC2 Type II compliance readiness."
    hitos:
      - id: "4.1"
        title: "SSO/SAML & RBAC"
        description: "Enterprise identity and access control."
        status: "pending"
        gate: "RBAC policies enforced per sub-graph."
        tasks: []
        evidence_nodes: []

      - id: "4.2"
        title: "Local Compiler (Universal BYOE)"
        description: "Privacy Mode supporting local LLM endpoints (Ollama, vLLM) via OpenAI standards."
        status: "done"
        gate: "Gateway validates and routes to custom endpoints successfully."
        tasks:
          - "Implement baseUrl support in SettingsStore"
          - "Implement callCustomOpenAI adapter in Gateway"
          - "Implement Endpoint Verification logic"
          - "Build Universal Endpoint Config UI"
        evidence_nodes:
          - "src/kernel/llm/gateway.ts"
          - "documentacion/HITO_4.2_LOCAL_COMPILER.md"

      - id: "4.3"
        title: "Forensic UX (Internal Audit)"
        description: "Circuit Breaker and X-Ray mode for radical transparency and logic enforcement."
        status: "done"
        gate: "Alt-key X-Ray and LogicCircuitBreakerError UI are functional."
        tasks:
          - "Implement LogicCircuitBreakerError (Kernel)"
          - "Update Verifier to trigger CRITICAL halts"
          - "Implement XRayOverlay & SmartViewer bridge"
          - "Implement Red-Screen Circuit Breaker UI"
        evidence_nodes:
          - "src/components/ui/CircuitBreaker.tsx"
          - "src/components/ui/XRayOverlay.tsx"
          - "documentacion/HITO_4.3_FORENSIC_UX.md"

      - id: "4.4"
        title: "Authority Signature (Pact with AI)"
        description: "Cryptographic human seals to protect ground truth and enforce AI obedience in RLM."
        status: "done"
        gate: "Assembler respects signed nodes and Verifier detects broken seals."
        tasks:
          - "Implement human_signature schema (IR)"
          - "Update Assembler RLM loop with sanctity enforcement"
          - "Implement Wax Seal UI in NodeEditor"
          - "Add BROKEN_SIGNATURE_SEAL check to Verifier"
        evidence_nodes:
          - "src/components/editor/NodeEditor.tsx"
          - "documentacion/HITO_4.4_AUTHORITY_SIGNATURE.md"

      - id: "4.5"
        title: "Audit & Public Observability"
        description: "Expose AI machinery (tokens, cost, latency) per section via Engineer HUD."
        status: "done"
        gate: "HUD shows real-time job metrics in X-Ray mode."
        tasks:
          - "Implement AuditStore (Kernel)"
          - "Integrate section metrics in Assembler loop"
          - "Implement Engineer HUD in XRayOverlay"
        evidence_nodes:
          - "src/kernel/observability.ts"
          - "documentacion/HITO_4.5_AUDIT_LOGS.md"

  - id: 5
    title: "Phase 5: Universal Capture System"
    description: "Frictionless knowledge capture from any source."
    phase_gate: "Files and text can be captured from LLMs, cloud services, and local system."
    hitos:
      - id: "5.1"
        title: "LLM File Capture"
        description: "Capture files uploaded to ChatGPT, Claude, and Gemini interfaces."
        status: "done"
        gate: "Extension detects and captures files from all major LLM platforms."
        tasks:
          - "Implement BaseFileDetector interface"
          - "Implement ChatGPTDetector"
          - "Implement ClaudeDetector"
          - "Implement GeminiDetector"
          - "Implement DragDropHandler for file dragging"
          - "Add CAPTURE_FILE handler in background script"
          - "Create /api/ingest/file endpoint"
        evidence_nodes:
          - "extension/src/content/file-detector.ts"
          - "extension/src/content/chatgpt-detector.ts"
          - "extension/src/content/claude-detector.ts"
          - "extension/src/content/gemini-detector.ts"
          - "extension/src/content/drag-drop-handler.ts"
          - "extension/src/background/index.ts"
          - "src/app/api/ingest/file/route.ts"
          - "documentacion/SISTEMA_CAPTURA_UNIVERSAL.md"

      - id: "5.2"
        title: "Text-to-Node Drag & Drop"
        description: "Direct text selection capture to floating windows with auto-node creation."
        status: "done"
        gate: "Text can be dragged from any web page to floating panels."
        tasks:
          - "Enhance FloatingPanel with drag & drop handlers"
          - "Implement visual feedback for drop zones"
          - "Add text/file type detection"
          - "Create /api/nodes/quick endpoint"
          - "Support source URL capture"
        evidence_nodes:
          - "src/components/ui/FloatingPanel.tsx"
          - "src/app/api/nodes/quick/route.ts"
          - "documentacion/SISTEMA_CAPTURA_UNIVERSAL.md"

      - id: "5.3"
        title: "Cloud Storage Integration"
        description: "Capture files from Notion, Google Drive, Dropbox interfaces."
        status: "done"
        gate: "Files from cloud platforms captured with same UX as LLM files."
        tasks:
          - "Implement CloudFileDetector interface"
          - "Implement GoogleDriveDetector"
          - "Implement NotionDetector"
          - "Implement DropboxDetector"
          - "Implement unified CloudStorageCapture system"
          - "Add CAPTURE_CLOUD_FILE handler in background script"
        evidence_nodes:
          - "extension/src/content/cloud-detectors/base.ts"
          - "extension/src/content/cloud-detectors/google-drive.ts"
          - "extension/src/content/cloud-detectors/notion.ts"
          - "extension/src/content/cloud-detectors/dropbox.ts"
          - "extension/src/content/cloud-detectors/index.ts"
          - "extension/src/background/index.ts"
          - "documentacion/HITO_5.3_CLOUD_STORAGE.md"

      - id: "5.4"
        title: "X-Ray Vision: Ambient Percept"
        description: "Real-time semantic analysis and visual highlighting of web content."
        status: "done"
        gate: "Ambient scanner identifies IR types (Claim/Evidence) with zero-click HUD metrics."
        tasks:
          - "Implement TextBlockDetector (Ambient Scanner)"
          - "Implement SemanticBuffer (Batch Queue)"
          - "Build XRayHighlighter (Visual Layer w/ Shadow DOM)"
          - "Implement XRayHUD (Real-time Engineering Metrics)"
          - "Integrate One-Click Capture to /api/nodes/quick"
        evidence_nodes:
          - "extension/src/content/text-block-detector.ts"
          - "extension/src/content/semantic-buffer.ts"
          - "extension/src/content/xray-highlighter.ts"
          - "extension/src/content/xray-hud.ts"
          - "extension/src/content/xray-system.ts"
          - "documentacion/XRAY_VISION_TECHNICAL.md"

operational_rules:
  sequential_execution: true # Mandatory: Hito N requires Hito N-1 as Done.
  gate_enforcement: "Strict - Phase Gates must be satisfied for milestone closure."
  documentation_level: "Structured node-by-node according to canon/04_definition_of_done.md."
  traceability: "Mandatory population of evidence_nodes list for each hito."

phases:
  - id: 0
    title: "Phase 0: The IR Kernel (Execution Core)"
    description: "Foundational layer for structured knowledge."
    phase_gate: "A node cannot be deleted if it is a PIN or has active dependents."
    hitos:
      - id: "0.1"
        title: "IR Schema Definition"
        description: "Schema definition for WorkGraph IR (Nodes/Edges/Metadata)."
        status: "done"
        gate: "Zod schema for all node types defined and validated."
        tasks: 
          - "Define PREFLIGHT_TEMPLATE.md (Process)"
          - "Define WorkNodeSchema V2 (Claims, Evidence, Decisions)"
          - "Define NodeMetadataSchema V2 (Confidence, Pin, Validated)"
          - "Define WorkEdgeSchema (Edges)"
        evidence_nodes: 
          - "PLAN-HITO-0.1.md"
          - "src/canon/schema/ir.ts"
          - "tests/schema.test.ts"

      - id: "0.2"
        title: "Versioning Engine"
        description: "Hash-based delta tracking (git-like for the graph)."
        status: "done"
        gate: "Hash-based delta verification operational."
        tasks:
          - "Implement computeNodeHash (kernel)"
          - "Implement verifyIntegrity (kernel)"
          - "Implement createVersion (kernel)"
          - "Implement previous_version_hash chaining"
        evidence_nodes: 
          - "PLAN-HITO-0.2.md"
          - "src/kernel/versioning.ts"
          - "tests/versioning.test.ts"

      - id: "0.3"
        title: "PIN Enforcement"
        description: "PIN/Invariant enforcement logic in the DB layer (Kernel for now)."
        status: "done"
        gate: "Kernel guards preventing contradiction of PIN nodes."
        tasks:
          - "Implement canModifyNode (Guard)"
          - "Implement canDeleteNode (Guard/Dependency Check)"
          - "Implement KernelLogger (Observability)"
        evidence_nodes: 
          - "PLAN-HITO-0.3.md"
          - "src/kernel/guards.ts"
          - "tests/guards.test.ts"

  - id: 1
    title: "Phase 1: RLM Compiler v1 (Deliverable Engine)"
    description: "The primary execution engine for generating deliverables."
    phase_gate: "Deliverables must include an Assertion Map to be marked as 'Done'."
    hitos:
      - id: "1.1"
        title: "Compiler Pipeline (Dry Run)"
        description: "Scaffolding of the RLM compiler (Planner -> Retriever -> Assembler) with deterministic stubs."
        status: "done"
        gate: "Dry run of the pipeline (Input -> Artifact) passes."
        tasks:
          - "Implement Planner (Stub)"
          - "Implement Retriever (Stub)"
          - "Implement Assembler (Stub)"
          - "Implement Pipeline Orchestrator"
        evidence_nodes: 
          - "PLAN-HITO-1.1.md"
          - "src/compiler/index.ts"
          - "tests/compiler.test.ts"

      - id: "1.2"
        title: "Manifest Templates"
        description: "Typed templates for Artifact generation (Code, Docs, Plans)."
        status: "done"
        gate: "Assembler uses typed templates instead of raw strings."
        tasks:
          - "Implement Template Interface"
          - "Implement CodeManifest"
          - "Implement DocManifest"
          - "Implement PlanManifest"
          - "Refactor Assembler to use Templates"
        evidence_nodes: 
          - "PLAN-HITO-1.2.md"
          - "src/compiler/templates/"
          - "tests/templates.test.ts"

      - id: "1.3"
        title: "Proof-Carrying Deliverables"
        description: "Receipts generation for proof of work."
        status: "done"
        gate: "Metadata receipts attached to all outputs."
        tasks:
          - "Define ReceiptSchema & AssertionMapSchema"
          - "Extract Primitives (Schema Refactor)"
          - "Extend ArtifactNode with Receipt"
          - "Update Assembler to attach Receipts"
        evidence_nodes: 
          - "PLAN-HITO-1.3.md"
          - "src/canon/schema/receipt.ts"
          - "src/canon/schema/primitives.ts"
          - "tests/receipts.test.ts"

      - id: "1.4"
        title: "The Verifier Logic"
        description: "Deterministic verification of artifacts (Structure, Integrity, Thresholds)."
        status: "done"
        gate: "The pipeline returns an Artifact containing a VerificationReport."
        tasks:
          - "Define VerificationReportSchema"
          - "Implement src/compiler/verifier.ts"
          - "Implement Filter logic"
          - "Integrate Verifier into Pipeline"
        evidence_nodes: 
          - "PLAN-HITO-1.4.md"
          - "src/compiler/verifier.ts"
          - "tests/verifier.test.ts"


  - id: 2
    title: "Phase 2: Capture & Extensibility (The Wedge)"
    description: "Expanding the surface area for knowledge entry."
    phase_gate: "Captures must pass Zod validation before entering the WorkGraph."
    hitos:
      - id: "2.1"
        title: "Chrome MV3 Extension"
        description: "Explicit selection capture for the web."
        status: "pending"
        gate: "MV3 extension communicating with the kernel."
        tasks: []
        evidence_nodes: []

      - id: "2.2"
        title: "Multi-source Ingestion"
        description: "Ingestion from URLs, Local Files, and Chat Export."
        status: "pending"
        gate: "Multi-format parser operational."
        tasks: []
        evidence_nodes: []

      - id: "2.3"
        title: "BYOK Secrets Management"
        description: "Vault integration for user keys."
        status: "pending"
        gate: "Encryption at rest for all third-party keys."
        tasks: []
        evidence_nodes: []

  - id: 3
    title: "Phase 3: Scaling & Verification (Operational Excellence)"
    description: "Hardening the system for high-volume data."
    phase_gate: "RLM Compiler identifies contradictions with the Canon automatically."
    hitos:
      - id: "3.1"
        title: "Hierarchical Digests"
        description: "Branch/Project summarization logic."
        status: "pending"
        gate: "Automatic summary generation for nested nodes."
        tasks: []
        evidence_nodes: []

      - id: "3.2"
        title: "Staleness Detection"
        description: "Evidence expiration and invalidation warnings."
        status: "pending"
        gate: "Evidence age tracking active."
        tasks: []
        evidence_nodes: []

      - id: "3.3"
        title: "Collaborative Governance"
        description: "Propose/Approve workflows (Human-led)."
        status: "pending"
        gate: "Human assignment for node validation."
        tasks: []
        evidence_nodes: []

  - id: 4
    title: "Phase 4: Enterprise Hardening"
    description: "Readying the platform for professional organizations."
    phase_gate: "SOC2 Type II compliance readiness."
    hitos:
      - id: "4.1"
        title: "SSO/SAML & RBAC"
        description: "Enterprise identity and access control."
        status: "pending"
        gate: "RBAC policies enforced per sub-graph."
        tasks: []
        evidence_nodes: []

      - id: "4.2"
        title: "Local Compiler"
        description: "Disconnected mode for ultimate privacy."
        status: "pending"
        gate: "Local LLM fallback functional."
        tasks: []
        evidence_nodes: []

      - id: "4.3"
        title: "SIEM Audit"
        description: "Complete traceability for external auditors."
        status: "pending"
        gate: "Audit log export active."
        tasks: []
        evidence_nodes: []

operational_rules:
  sequential_execution: true # Mandatory: Hito N requires Hito N-1 as Done.
  gate_enforcement: "Strict - Phase Gates must be satisfied for milestone closure."
  documentation_level: "Structured node-by-node according to canon/04_definition_of_done.md."
  traceability: "Mandatory population of evidence_nodes list for each hito."
